<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="hu.uni.miskolc.iit.swtest.registrar.persist.mysql.mapper.CustomerMapper">

	<!-- <resultMap type="hu.uni.miskolc.iit.swtest.registrar.model.Address" 
		id="AddressRM"> <result property="country" column="country" /> <result property="city" 
		column="city" /> <result property="street" column="street" /> <result property="number" 
		column="num" /> </resultMap> -->

	<resultMap type="Customer" id="CustomerResultMap">
		<id property="customerID" column="id" />
		<result property="name" column="name" />
		<!-- <association property="address" column="{country, city, street, num}" 
			resultMap="hu.uni.miskolc.iit.swtest.registrar.persist.mysql.mapper.AddressMapper.AddressResultMap"> 
			</association> -->
		<association property="address" column="addressID"
			javaType="hu.uni.miskolc.iit.swtest.registrar.model.Address"
			resultMap="hu.uni.miskolc.iit.swtest.registrar.persist.mysql.mapper.AddressMapper.AddressResultMap" />
	</resultMap>

	<select id="queryAddress"
		resultMap="hu.uni.miskolc.iit.swtest.registrar.persist.mysql.mapper.AddressMapper.AddressResultMap">
		select country as country,
		city as city,
		street as street, num
		as number from customerTable where
		id = #{id};
	</select>

	<select id="selectCustomers" resultMap="CustomerResultMap">
		select * from
		customerTable;
	</select>

	<select id="selectCustomersByName" resultMap="CustomerResultMap">
		select * from
		customerTable where name like #{name};
	</select>

	<select id="selectCustomersByAddress" resultMap="CustomerResultMap">
		select * from
		customerTable where country like #{address.country} and city like
		#{address.city} and street like #{address.street} and num =
		#{address.number};
	</select>

	<select id="selectCustomersByCountry" resultMap="CustomerResultMap">
		select * from
		customerTable where country like #{country};
	</select>

	<select id="selectCustomersByCity" resultMap="CustomerResultMap">
		select * from
		customerTable where country like #{country} and city like #{city};
	</select>

	<select id="selectCustomersByStreet" resultMap="CustomerResultMap">
		select * from
		customerTable where country like #{country} and city like #{city} and
		street like #{street};
	</select>

	<select id="selectCustomerByID" resultMap="CustomerResultMap">
		select * from
		customerTable where id = #{id};
	</select>

	<insert id="recordCustomer">
		insert into customerTable (name, country, city,
		street, num) values (#{name}, #{address.country}, #{address.city},
		#{address.street}, #{address.number});
	</insert>

	<update id="updateCustomer" parameterType="Customer">
		update customerTable
		set name = #{customer.name} where id = #{customer.customerID};
	</update>

	<delete id="deleteCustomer" parameterType="Customer">
		delete from
		customerTable where id = #{customer.customerID};
	</delete>

</mapper>